<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project G</title>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
    <script type="text/javascript" src="https://rawgithub.com/craftyjs/Crafty/release/dist/crafty-min.js"></script>
    <link type="text/css" rel="stylesheet" href="css/main.css">
    <meta name="viewport" content="user-scalable=no">
</head>
<body>
    <div id="game">


    </div>

    <script>
        Crafty.init(document.documentElement.clientWidth,900, document.getElementById('game'));
    </script>
    <script src="data/platforms.js"></script>
    <script src="data/actions.js"></script>
    <script src="data/sprites.js"></script>
    <script src="data/items.js"></script>
    <div class="button-up">
        <img src="stok/arrow_up.png">
    </div>
    <div class="button-down">
        <img src="stok/arrow_down.png">
    </div>
    <div class="button-left">
        <img src="stok/arrow_left.png">
    </div>
    <div class="button-right">
        <img src="stok/arrow_right.png">
    </div>
    <div class="button-enter">
        <img src="stok/enter_key.png" >
    </div>
    <script>
        $('.button-up').on('touchstart',function(){player.jump()});
        $('.button-down').on('touchstart',function(){
            if(player.ground){
                    if(player.y<=430){
                    let lost_ground =  player.ground;
                    player.ground.removeComponent('Floor');
                    setTimeout(()=>lost_ground.addComponent('Floor'),500);
                    }
                }
        });
        $('.button-left').on('touchstart',function () {
            let evt = new KeyboardEvent('keydown', {'keyCode':37, 'which':37});
            document.dispatchEvent(evt);
        });
        $('.button-left').on('touchend', function () {
            let evt = new KeyboardEvent('keyup', {'keyCode':37, 'which':37});
            document.dispatchEvent(evt);
        });
        $('.button-right').on('touchstart',function () {
            let evt = new KeyboardEvent('keydown', {'keyCode':39, 'which':39});
            document.dispatchEvent(evt);
        });
        $('.button-right').on('touchend',function () {
            let evt = new KeyboardEvent('keyup', {'keyCode':39, 'which':39});
            document.dispatchEvent(evt);
        });
        $('.button-enter').on('touchend',function () {
            if (user_num_cd){
                user_num_cd--;
                cd_num_text.text(':'+user_num_cd.toString());
                Crafty.e('2D, Canvas, cd')
                    .attr({x:player.x+20, y:player.y+20})
                    .bind("UpdateFrame", function () {
                        this.x = this.x + 10;
                        if (this.x > document.documentElement.clientWidth+100)
                            this.destroy();
                    });
            }
            

        });
        document.addEventListener('keydown', function(event) {
        if (event.code == 'ArrowDown' || event.code == 'KeyS') {
            if(player.ground){
                    if(player.y<=430){
                    let lost_ground =  player.ground;
                    player.ground.removeComponent('Floor');
                    setTimeout(()=>lost_ground.addComponent('Floor'),500);
                    }
                }
        }
        else if (event.code == "Space"){
                if (user_num_cd){
                user_num_cd--;
                cd_num_text.text(':'+user_num_cd.toString());
                Crafty.e('2D, Canvas, cd')
                    .attr({x:player.x+20, y:player.y+20})
                    .bind("UpdateFrame", function () {
                        this.x = this.x + 10;
                        if (this.x > document.documentElement.clientWidth+100)
                            this.destroy();
                    });
            }
        }
        });
    </script>
</body>
</html>